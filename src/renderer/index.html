<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- CSP meta tag: replaced at build time by vite-plugin-csp-swap (see vite.config.ts) -->
  <meta http-equiv="Content-Security-Policy"
    content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval' http://localhost:*; style-src 'self' 'unsafe-inline'; connect-src 'self' http://localhost:* ws://localhost:*; img-src 'self' data: blob: https:; font-src 'self' data: https://fonts.gstatic.com">
  <title>Clawdia</title>
  <link rel="stylesheet" href="styles.css">
</head>

<body>
  <div class="container">
    <div class="app-container">
      <!-- Sidebar Navigation -->
      <nav id="sidebar-nav" class="sidebar-nav">
        <button id="nav-new-chat" class="sidebar-nav-btn sidebar-new-chat-btn" title="New Chat">
          <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
            stroke-linecap="round" stroke-linejoin="round">
            <line x1="12" y1="5" x2="12" y2="19" />
            <line x1="5" y1="12" x2="19" y2="12" />
          </svg>
        </button>
        <button id="nav-chat" class="sidebar-nav-btn sidebar-nav-btn--active" title="Chat" data-view="chat">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M21 15a2 2 0 0 1-2 2H7l-4 4V5a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2z" />
          </svg>
        </button>
        <button id="nav-tasks" class="sidebar-nav-btn" title="Tasks" data-view="tasks">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M9 11l3 3L22 4" />
            <path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11" />
          </svg>
          <span id="nav-tasks-badge" class="sidebar-nav-badge hidden"></span>
        </button>
        <button id="nav-timeline" class="sidebar-nav-btn" title="Security Timeline" data-view="timeline">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M12 22s8-4 8-10V5l-8-3-8 3v7c0 6 8 10 8 10z" />
          </svg>
        </button>
        <button id="nav-readme" class="sidebar-nav-btn" title="README" data-view="readme">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
            stroke-linecap="round" stroke-linejoin="round">
            <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z" />
            <path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z" />
          </svg>
        </button>
        <div class="sidebar-nav-spacer"></div>
        <button id="nav-telegram" class="sidebar-nav-btn sidebar-nav-telegram hidden" title="Telegram Chat" data-view="telegram">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" stroke="none">
            <path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm4.64 6.8c-.15 1.58-.8 5.42-1.13 7.19-.14.75-.42 1-.68 1.03-.58.05-1.02-.38-1.58-.75-.88-.58-1.38-.94-2.23-1.5-.99-.65-.35-1.01.22-1.59.15-.15 2.71-2.48 2.76-2.69a.2.2 0 00-.05-.18c-.06-.05-.14-.03-.21-.02-.09.02-1.49.95-4.22 2.79-.4.27-.76.41-1.08.4-.36-.01-1.04-.2-1.55-.37-.63-.2-1.12-.31-1.08-.66.02-.18.27-.36.74-.55 2.92-1.27 4.86-2.11 5.83-2.51 2.78-1.16 3.35-1.36 3.73-1.36.08 0 .27.02.39.12.1.08.13.19.14.27-.01.06.01.24 0 .38z"/>
          </svg>
        </button>
        <button id="nav-settings" class="sidebar-nav-btn" title="Settings" data-view="settings">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5"
            stroke-linecap="round" stroke-linejoin="round">
            <circle cx="12" cy="12" r="3" />
            <path
              d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82V9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z" />
          </svg>
        </button>
      </nav>

      <!-- Chat Panel (left 35%) -->
      <div id="chat-container" class="chat-container">
        <div class="main-content">
          <div id="chat-app-shell" class="chat-app-shell">
            <!-- Header -->
            <header class="header">
              <span class="brand-name">Clawdia</span>
              <div class="header-spacer"></div>
              <div class="header-controls">
                <button id="browser-toggle" class="header-icon-btn" title="Toggle browser panel">
                  <svg width="18" height="18" viewBox="0 0 16 16" fill="none" stroke="currentColor" stroke-width="1.5"
                    stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="8" cy="8" r="6.5" />
                    <ellipse cx="8" cy="8" rx="2.5" ry="6.5" />
                    <line x1="1.5" y1="8" x2="14.5" y2="8" />
                  </svg>
                </button>
                <div id="vault-status" class="vault-status hidden">
                  <span class="vault-status-icon">üì•</span>
                  <span class="vault-status-text">Ingesting...</span>
                </div>
                <div id="header-clock" class="header-clock">00:00</div>
                <div class="window-controls">
                  <button id="min-btn" class="window-btn" title="Minimize">
                    <svg width="12" height="12" viewBox="0 0 10 10" fill="none" stroke="currentColor" stroke-width="1.5"
                      stroke-linecap="round">
                      <line x1="2" y1="5" x2="8" y2="5" />
                    </svg>
                  </button>
                  <button id="max-btn" class="window-btn" title="Maximize">
                    <svg width="12" height="12" viewBox="0 0 10 10" fill="none" stroke="currentColor" stroke-width="1.5"
                      stroke-linecap="round" stroke-linejoin="round">
                      <rect x="2" y="2" width="6" height="6" />
                    </svg>
                  </button>
                  <button id="close-btn" class="window-btn window-btn-close" title="Close">
                    <svg width="12" height="12" viewBox="0 0 10 10" fill="none" stroke="currentColor" stroke-width="1.5"
                      stroke-linecap="round">
                      <line x1="2" y1="2" x2="8" y2="8" />
                      <line x1="8" y1="2" x2="2" y2="8" />
                    </svg>
                  </button>
                </div>
              </div>
            </header>

            <!-- Chat Area -->
            <main class="chat-area">
              <!-- Hidden chat tabs container ‚Äî state management still uses this -->
              <div class="source-tabs chat-tabs hidden" id="chat-tabs" role="tablist" aria-label="Chat conversations">
              </div>
              <div class="chat-scroll-region">
                <div id="output" class="output"></div>
              </div>
            </main>

            <!-- Input Section -->
            <footer class="input-section">
              <div id="approval-panel-container" class="approval-panel-container hidden"></div>
              <div id="attachment-bar" class="attachment-bar"></div>
              <div class="input-row">
                <div class="prompt-wrapper">
                  <textarea id="prompt" placeholder="Ask me anything..." rows="1"></textarea>

                  <div class="input-meta-inside">
                    <div class="input-meta-left">
                      <button id="attach-btn" class="attach-btn-inline" type="button" title="Attach file">
                        <svg width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path
                            d="M21.44 11.05l-9.19 9.19a6 6 0 0 1-8.49-8.49l9.19-9.19a4 4 0 0 1 5.66 5.66l-9.2 9.19a2 2 0 0 1-2.83-2.83l8.49-8.48" />
                        </svg>
                      </button>
                      <button id="model-picker-btn" class="model-picker-btn" type="button" title="Switch model">
                        <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                          stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                          <path d="M12 2a4 4 0 0 1 4 4v2a4 4 0 0 1-8 0V6a4 4 0 0 1 4-4z" />
                          <path d="M12 12v4" />
                          <path d="M8 22h8" />
                          <path d="M12 16v6" />
                          <path d="M7 12h10" />
                        </svg>
                        <span id="model-picker-label">Sonnet 4.5</span>
                      </button>
                      <div id="model-picker-popup" class="model-picker-popup hidden">
                        <div class="model-picker-list" id="model-picker-list"></div>
                      </div>
                      <div class="autonomy-anchor">
                        <button id="autonomy-trigger" class="autonomy-trigger" type="button"
                          title="Autonomy mode">Guided</button>
                        <div id="autonomy-popover" class="autonomy-popover hidden"></div>
                      </div>
                    </div>
                    <div id="token-stats" class="token-stats"></div>
                  </div>

                  <div class="input-controls">
                    <button id="cancel" class="secondary hidden" type="button" title="Stop generation"></button>
                    <button id="send" class="primary" type="button" title="Send message"></button>
                  </div>
                </div>
              </div>
            </footer>
          </div>

          <!-- Conversations View (shown inside chat panel when toggled) -->
          <div id="conversations-view" class="view-panel hidden">
            <div class="view-panel-inner">
              <div class="view-panel-header">
                <h2 class="view-panel-title">Conversations</h2>
                <div class="conv-header-actions">
                  <button id="clear-all-conversations-btn" class="conv-clear-all-btn" type="button" title="Clear all conversations">Clear All</button>
                  <button id="new-conversation-btn" class="view-new-btn" type="button" title="New conversation">
                    <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                      stroke-linecap="round">
                      <line x1="12" y1="5" x2="12" y2="19" />
                      <line x1="5" y1="12" x2="19" y2="12" />
                    </svg>
                    New Chat
                  </button>
                </div>
              </div>
              <div class="view-search-wrap">
                <input type="text" id="conversations-search" class="view-search-input"
                  placeholder="Search conversations..." autocomplete="off" spellcheck="false">
              </div>
              <div id="conversations-list" class="conversations-view-list"></div>
            </div>
          </div>

          <div id="readme-view" class="view-panel hidden">
            <div class="readme-panel">
              <h1>C L A W D I A</h1>
              <p class="subtitle">User Guide</p>
              <hr class="divider">

              <h2 class="section-title">WHAT THIS IS</h2>
              <p>Clawdia is an AI desktop workspace. You chat with Claude on the left, and it controls a real browser on
                the right. It can also read, write, and execute anything on your local machine.</p>
              <p>There are no guardrails. This is a power tool.</p>

              <h2 class="section-title">BROWSER + YOUR ACCOUNTS</h2>
              <p>The browser panel shares your active login sessions. If you're logged into GitHub, Gmail, Amazon, or
                anything else, Claude can access those sites as you.</p>
              <p>This is the key feature. Claude can:</p>
              <div class="indent">
                <p class="arrow-item">&rarr; Read your GitHub repos and PRs</p>
                <p class="arrow-item">&rarr; Search your Gmail</p>
                <p class="arrow-item">&rarr; Navigate your cloud dashboards</p>
                <p class="arrow-item">&rarr; Fill out forms on authenticated pages</p>
                <p class="arrow-item">&rarr; Access any site you're signed into</p>
              </div>
              <p><strong>HOW TO SET UP:</strong> Open the browser panel, navigate to the sites you want Claude to
                access, and log in normally. Your sessions persist across app restarts. Claude will use your cookies
                automatically.</p>
              <p><strong>TO REVOKE ACCESS:</strong> Log out of any site you don't want Claude to reach, then clear
                browser data using the <code>&#8942;</code> menu in the browser panel's tab bar. Sessions are only
                shared while you're logged in.</p>

              <h2 class="section-title">LOCAL SYSTEM ACCESS</h2>
              <p>Claude has full, unrestricted access to your machine through 6 local tools:</p>
              <div class="indent">
                <p><code>shell</code> &mdash; Run any bash command. sudo included. No restrictions.</p>
                <p><code>read</code> &mdash; Read any file on your filesystem.</p>
                <p><code>write</code> &mdash; Create or overwrite any file.</p>
                <p><code>edit</code> &mdash; Modify files in place with find/replace.</p>
                <p><code>tree</code> &mdash; Explore directory structures.</p>
                <p><code>process</code> &mdash; Start, stop, and list running processes.</p>
              </div>
              <p>Claude can install packages, run scripts, compile code, manage git repos, modify system configs, and
                automate multi-step workflows &mdash; all through natural conversation.</p>
              <p><strong>THIS MEANS FULL OS ACCESS.</strong> Claude can do anything your user account can do. It will
                not execute destructive commands without asking first, but you should understand the scope of what
                you're granting.</p>

              <h2 class="section-title">BROWSER TOOLS</h2>
              <p>Claude controls the browser with 8 tools:</p>
              <div class="indent">
                <p><code>search</code> &mdash; Google search, returns top results</p>
                <p><code>navigate</code> &mdash; Go to any URL</p>
                <p><code>read</code> &mdash; Extract page content and interactive elements</p>
                <p><code>click</code> &mdash; Click buttons, links, form elements</p>
                <p><code>type</code> &mdash; Fill in text fields and forms</p>
                <p><code>scroll</code> &mdash; Scroll pages up/down</p>
                <p><code>screenshot</code> &mdash; Capture visible page</p>
                <p><code>tabs</code> &mdash; Open, close, switch between tabs</p>
              </div>
              <p>Claude reads pages using accessibility tree extraction &mdash; it sees text, links, buttons, inputs,
                and their positions. It can interact with any website the same way you would.</p>

              <h2 class="section-title">WHAT YOU CAN DO</h2>
              <div class="indent">
                <p class="example">"Log into my AWS console and check my EC2 instances"</p>
                <p class="example">"Read my latest emails in Gmail"</p>
                <p class="example">"Search GitHub for React datepicker libraries and compare the top 3"</p>
                <p class="example">"Write a Python script that processes all CSVs in my Downloads folder"</p>
                <p class="example">"Find the cheapest flight to Denver next weekend"</p>
                <p class="example">"Push my project to GitHub"</p>
                <p class="example">"Install Node 20 and set up a new Vite project in ~/projects"</p>
                <p class="example">"Edit the config file at /etc/nginx/nginx.conf"</p>
              </div>

              <h2 class="section-title">MODELS</h2>
              <p>Switch between Claude models using the selector in the input bar:</p>
              <div class="indent">
                <p><strong>Haiku 4.5</strong> &mdash; Fast, cheap. Good for quick questions and simple tasks.</p>
                <p><strong>Sonnet 4</strong> &mdash; Balanced. Best for most tasks. Default.</p>
                <p><strong>Opus 4</strong> &mdash; Most capable. Complex research, long generation, hard problems.</p>
              </div>
              <p>All models have identical tool access. The difference is speed, cost, and reasoning depth.</p>

              <h2 class="section-title">TIPS</h2>
              <div class="indent">
                <p class="arrow-item">&rarr; Start sessions by logging into sites you'll need. Claude remembers sessions
                  between restarts.</p>
                <p class="arrow-item">&rarr; For research tasks, Claude will open multiple tabs and compare sources. You
                  can watch it work in real time.</p>
                <p class="arrow-item">&rarr; Claude can modify its own source code. Ask it to change the app's behavior
                  and it will edit the files directly.</p>
                <p class="arrow-item">&rarr; If Claude gets stuck in a loop, hit Cancel to stop the current tool chain.
                </p>
                <p class="arrow-item">&rarr; Images can be pasted (Ctrl+V) or dragged into the chat for vision analysis.
                </p>
                <p class="arrow-item">&rarr; Documents (PDF, DOCX, XLSX) can be dropped into chat for Claude to read and
                  analyze.</p>
              </div>

              <h2 class="section-title">PRIVACY &amp; SECURITY</h2>
              <p>Everything runs locally. Your conversations, files, and browser sessions never leave your machine
                except for API calls directly to Anthropic (for Claude) and your configured search provider.</p>
              <p>Your API keys are stored encrypted on disk in your local app data directory. They are never transmitted
                to anyone other than the respective API providers.</p>
              <p>Browser cookies and sessions are stored locally by Electron's Chromium instance, same as any desktop
                browser.</p>
              <p>To fully reset: clear all browser data via the <code>&#8942;</code> menu in the browser panel, remove
                your API keys in Settings, and delete the app data directory.</p>

              <hr class="divider">
              <p class="readme-footer">Built by Daniel Parker<br>github.com/chillysbabybackribs/Clawdia</p>
            </div>
          </div>

          <!-- Settings View -->
          <div id="settings-view" class="view-panel hidden">
            <div class="view-panel-inner settings-view-inner">
              <div class="view-panel-header">
                <h2 class="view-panel-title">Settings</h2>
              </div>
              <div id="settings-body" class="settings-view-body"></div>
            </div>
          </div>

          <!-- Security Timeline View -->
          <div id="timeline-view" class="view-panel hidden">
            <div class="view-panel-inner tl-panel">
              <div class="view-panel-header tl-header">
                <h2 class="view-panel-title">Security Timeline</h2>
                <button id="tl-clear-btn" class="tl-clear-btn" type="button" title="Clear timeline">Clear</button>
              </div>
              <div class="tl-filters" id="tl-filters">
                <button class="tl-filter-btn tl-filter-btn--active" data-filter="all">All</button>
                <button class="tl-filter-btn" data-filter="approvals">Approvals</button>
                <button class="tl-filter-btn" data-filter="blocked">Blocked</button>
                <button class="tl-filter-btn" data-filter="executed">Executed</button>
              </div>
              <div id="tl-events" class="tl-events"></div>
              <div id="tl-empty" class="tl-empty hidden">
                <p>No security events yet.</p>
                <p class="tl-empty-sub">Events will appear here as Clawdia interacts with your system.</p>
              </div>
            </div>
          </div>

          <div id="task-view" class="task-view hidden">
            <div class="tv-container">
              <div class="tv-header">
                <h2 class="tv-title">Tasks</h2>
              </div>
              <div id="tv-content" class="tv-content"></div>
            </div>
          </div>

          <div id="setup-view" class="setup-view hidden">
            <div class="setup-card">
              <div class="setup-brand">
                <h1 class="setup-title">C L A W D I A</h1>
                <p class="setup-subtitle">AI Desktop Workspace</p>
              </div>
              <p class="setup-message">
                Enter your Anthropic API key to get started. Your key is stored locally and never leaves your machine.
              </p>
              <button id="setup-get-key-link" class="setup-link-btn" type="button">
                Get an API key at console.anthropic.com
              </button>
              <div class="setup-input-wrap">
                <input id="setup-api-key-input" type="password" placeholder="sk-ant-..." autocomplete="off"
                  spellcheck="false">
                <button id="setup-toggle-visibility" class="setup-visibility-btn" type="button"
                  aria-label="Show API key" title="Show API key">
                  <svg class="icon-eye" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                    stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M1 12s4-7 11-7s11 7 11 7s-4 7-11 7s-11-7-11-7Z"></path>
                    <circle cx="12" cy="12" r="3"></circle>
                  </svg>
                  <svg class="icon-eye-off hidden" width="16" height="16" viewBox="0 0 24 24" fill="none"
                    stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M3 3l18 18"></path>
                    <path d="M10.58 10.58A2 2 0 0 0 12 14a2 2 0 0 0 1.42-.58"></path>
                    <path d="M9.88 5.09A10.94 10.94 0 0 1 12 5c7 0 11 7 11 7a21.77 21.77 0 0 1-2.65 3.49"></path>
                    <path d="M6.61 6.61A21.79 21.79 0 0 0 1 12s4 7 11 7a10.94 10.94 0 0 0 5.39-1.61"></path>
                  </svg>
                </button>
              </div>
              <div class="setup-model-section">
                <label class="setup-model-label" for="setup-model-select">Model</label>
                <select id="setup-model-select" class="setup-model-select">
                  <!-- Populated dynamically from CLAUDE_MODELS -->
                </select>
              </div>
              <button id="setup-save-key-btn" class="primary setup-save-btn" type="button">
                <span id="setup-save-key-text">Validate &amp; Save</span>
                <span id="setup-save-key-spinner" class="setup-spinner hidden" aria-hidden="true"></span>
                <span id="setup-save-key-check" class="setup-check hidden" aria-hidden="true">‚úì</span>
              </button>
              <p id="setup-error" class="setup-error hidden"></p>
              <button id="setup-arcade-btn" class="setup-link-btn setup-arcade-btn" type="button">Play arcade while you
                set up</button>
              <div id="setup-arcade-host" class="setup-arcade-host hidden">
                <div id="setup-arcade-output" class="setup-arcade-output"></div>
              </div>
            </div>
          </div>
        </div>

        <!-- Settings Content (rendered into settings-view via JS) -->
        <div id="settings-modal" class="settings-content-source hidden">
          <div class="settings-form-body">
            <div class="form-group">
              <div class="api-key-label-row">
                <label>API Key</label>
                <button class="get-key-btn" type="button" data-url="https://console.anthropic.com/settings/keys"
                  title="Get API key">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                  </svg>
                </button>
                <span class="free-hint">free</span>
              </div>
              <div id="settings-api-key-masked" class="settings-api-key-masked">Not configured</div>
              <div class="settings-inline-actions">
                <button id="change-api-key-btn" class="secondary" type="button">Change Key</button>
                <button id="remove-api-key-btn" class="danger" type="button">Remove Key</button>
              </div>
              <div id="change-api-key-form" class="settings-change-key hidden">
                <div class="settings-key-input-row">
                  <input type="password" id="change-api-key-input" placeholder="sk-ant-...">
                  <button id="change-api-key-visibility" class="setup-visibility-btn" type="button"
                    aria-label="Show API key" title="Show API key">
                    <svg class="icon-eye" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor"
                      stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M1 12s4-7 11-7s11 7 11 7s-4 7-11 7s-11-7-11-7Z"></path>
                      <circle cx="12" cy="12" r="3"></circle>
                    </svg>
                    <svg class="icon-eye-off hidden" width="16" height="16" viewBox="0 0 24 24" fill="none"
                      stroke="currentColor" stroke-width="1.8" stroke-linecap="round" stroke-linejoin="round">
                      <path d="M3 3l18 18"></path>
                      <path d="M10.58 10.58A2 2 0 0 0 12 14a2 2 0 0 0 1.42-.58"></path>
                      <path d="M9.88 5.09A10.94 10.94 0 0 1 12 5c7 0 11 7 11 7a21.77 21.77 0 0 1-2.65 3.49"></path>
                      <path d="M6.61 6.61A21.79 21.79 0 0 0 1 12s4 7 11 7a10.94 10.94 0 0 0 5.39-1.61"></path>
                    </svg>
                  </button>
                </div>
                <div class="settings-inline-actions">
                  <button id="save-changed-api-key-btn" class="primary" type="button">Validate &amp; Save Key</button>
                  <button id="cancel-change-api-key-btn" class="secondary" type="button">Cancel</button>
                </div>
                <p id="change-api-key-error" class="setup-error hidden"></p>
              </div>
            </div>

            <div class="settings-section-label">Model</div>

            <div class="form-group">
              <label for="settings-model-select">Claude Model</label>
              <select id="settings-model-select">
                <!-- Populated dynamically from CLAUDE_MODELS -->
              </select>
            </div>

            <div class="settings-section-label">Search Backend</div>

            <div class="form-group">
              <label for="search-backend-select">Preferred Backend</label>
              <select id="search-backend-select">
                <option value="serper">Serper (recommended)</option>
                <option value="serpapi">SerpAPI</option>
                <option value="bing">Bing</option>
                <option value="playwright">Browser only (no API)</option>
              </select>
            </div>

            <div class="form-group">
              <div class="api-key-label-row">
                <label for="serper-key">Serper API Key</label>
                <button class="get-key-btn" type="button" data-url="https://serper.dev/api-key" title="Get API key">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                  </svg>
                </button>
                <span class="free-hint">free</span>
              </div>
              <input type="password" id="serper-key" placeholder="Serper API key">
            </div>

            <div class="form-group">
              <div class="api-key-label-row">
                <label for="serpapi-key">SerpAPI Key</label>
                <button class="get-key-btn" type="button" data-url="https://serpapi.com/manage-api-key"
                  title="Get API key">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                  </svg>
                </button>
                <span class="free-hint">free</span>
              </div>
              <input type="password" id="serpapi-key" placeholder="SerpAPI key">
            </div>

            <div class="form-group">
              <div class="api-key-label-row">
                <label for="bing-key">Bing API Key</label>
                <button class="get-key-btn" type="button"
                  data-url="https://www.microsoft.com/en-us/bing/apis/bing-web-search-api" title="Get API key">
                  <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"
                    stroke-linecap="round" stroke-linejoin="round">
                    <path d="M18 13v6a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V8a2 2 0 0 1 2-2h6"></path>
                    <polyline points="15 3 21 3 21 9"></polyline>
                    <line x1="10" y1="14" x2="21" y2="3"></line>
                  </svg>
                </button>
                <span class="free-hint">free</span>
              </div>
              <input type="password" id="bing-key" placeholder="Bing API key">
            </div>

            <div class="settings-section-label">Linked Accounts</div>
            <p class="accounts-description">Accounts are auto-detected when you browse authenticated sites. Claude
              uses your active sessions ‚Äî no passwords are stored.</p>
            <div id="accounts-list" class="accounts-list"></div>
            <div id="add-account-form" class="accounts-add-form hidden">
              <div class="accounts-add-fields">
                <div class="accounts-field">
                  <label for="add-account-domain">Domain</label>
                  <input type="text" id="add-account-domain" placeholder="e.g. mail.google.com" autocomplete="off"
                    spellcheck="false">
                </div>
                <div class="accounts-field">
                  <label for="add-account-username">Username</label>
                  <input type="text" id="add-account-username" placeholder="e.g. you@gmail.com" autocomplete="off"
                    spellcheck="false">
                </div>
                <input type="hidden" id="add-account-platform" value="">
              </div>
              <div class="accounts-add-actions">
                <button id="save-account-btn" class="primary" type="button">Add</button>
                <button id="cancel-account-btn" class="secondary" type="button">Cancel</button>
              </div>
            </div>
            <button id="add-account-btn" class="accounts-add-btn" type="button">+ Add account manually</button>

            <div class="settings-section-label">Ambient Awareness</div>
            <div class="ambient-settings">
              <div class="ambient-toggle-row ambient-master-row">
                <label class="ambient-toggle-label" for="ambient-master-toggle">Enable ambient awareness</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="ambient-master-toggle" checked>
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div id="ambient-sub-toggles" class="ambient-sub-toggles">
                <div class="ambient-toggle-row">
                  <div class="ambient-toggle-info">
                    <label class="ambient-toggle-label" for="ambient-browser-history">Browser history</label>
                    <span class="ambient-toggle-desc">Read recent browsing activity from Chrome/Chromium</span>
                  </div>
                  <label class="toggle-switch">
                    <input type="checkbox" id="ambient-browser-history" checked>
                    <span class="toggle-slider"></span>
                  </label>
                </div>

                <div class="ambient-toggle-row">
                  <div class="ambient-toggle-info">
                    <label class="ambient-toggle-label" for="ambient-filesystem-scan">Project scanning</label>
                    <span class="ambient-toggle-desc">Scan directories for project activity</span>
                  </div>
                  <label class="toggle-switch">
                    <input type="checkbox" id="ambient-filesystem-scan" checked>
                    <span class="toggle-slider"></span>
                  </label>
                </div>

                <div class="ambient-toggle-row">
                  <div class="ambient-toggle-info">
                    <label class="ambient-toggle-label" for="ambient-git-scan">Git status</label>
                    <span class="ambient-toggle-desc">Read repository status from git projects</span>
                  </div>
                  <label class="toggle-switch">
                    <input type="checkbox" id="ambient-git-scan" checked>
                    <span class="toggle-slider"></span>
                  </label>
                </div>

                <div class="ambient-toggle-row">
                  <div class="ambient-toggle-info">
                    <label class="ambient-toggle-label" for="ambient-shell-history">Terminal history</label>
                    <span class="ambient-toggle-desc">Read recent shell commands</span>
                  </div>
                  <label class="toggle-switch">
                    <input type="checkbox" id="ambient-shell-history" checked>
                    <span class="toggle-slider"></span>
                  </label>
                </div>

                <div class="ambient-toggle-row">
                  <div class="ambient-toggle-info">
                    <label class="ambient-toggle-label" for="ambient-recent-files">Recently opened files</label>
                    <span class="ambient-toggle-desc">Read files opened by other applications</span>
                  </div>
                  <label class="toggle-switch">
                    <input type="checkbox" id="ambient-recent-files" checked>
                    <span class="toggle-slider"></span>
                  </label>
                </div>

                <div class="ambient-scan-roots">
                  <label class="ambient-toggle-label">Scan directories</label>
                  <div id="ambient-scan-roots-list" class="ambient-scan-roots-list"></div>
                  <div class="ambient-scan-roots-add">
                    <input type="text" id="ambient-scan-root-input" placeholder="~/path/to/dir" autocomplete="off"
                      spellcheck="false">
                    <button id="ambient-scan-root-add-btn" class="secondary" type="button">Add</button>
                  </div>
                </div>
              </div>

              <p class="ambient-privacy-note">All data stays on your machine. Nothing is sent to external services.
              </p>
            </div>

            <div class="settings-section-label">Telegram Bot</div>
            <p class="telegram-description">Connect Clawdia to Telegram for mobile access.</p>

            <div class="settings-section-label">Capability Platform</div>
            <div class="capability-platform-panel">
              <div class="ambient-toggle-row">
                <div class="ambient-toggle-info">
                  <label class="ambient-toggle-label" for="cap-flag-install-orchestrator">Install orchestrator</label>
                  <span class="ambient-toggle-desc">Auto-install missing binaries with trust policy controls</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="cap-flag-install-orchestrator">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="ambient-toggle-row">
                <div class="ambient-toggle-info">
                  <label class="ambient-toggle-label" for="cap-flag-lifecycle-events">Lifecycle events</label>
                  <span class="ambient-toggle-desc">Emit dedicated capability event channels to renderer</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="cap-flag-lifecycle-events">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="ambient-toggle-row">
                <div class="ambient-toggle-info">
                  <label class="ambient-toggle-label" for="cap-flag-checkpoint-rollback">Checkpoint rollback</label>
                  <span class="ambient-toggle-desc">Create pre-mutation file checkpoints for writes/edits</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="cap-flag-checkpoint-rollback">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="ambient-toggle-row">
                <div class="ambient-toggle-info">
                  <label class="ambient-toggle-label" for="cap-flag-mcp-runtime">MCP runtime manager</label>
                  <span class="ambient-toggle-desc">Enable discovered MCP servers and runtime health manager</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="cap-flag-mcp-runtime">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="ambient-toggle-row">
                <div class="ambient-toggle-info">
                  <label class="ambient-toggle-label" for="cap-flag-containerize-mcp">Containerize MCP servers</label>
                  <span class="ambient-toggle-desc">Run external MCP servers inside container runtime</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="cap-flag-containerize-mcp">
                  <span class="toggle-slider"></span>
                </label>
              </div>
              <div class="ambient-toggle-row">
                <div class="ambient-toggle-info">
                  <label class="ambient-toggle-label" for="cap-flag-container-execution">Container execution</label>
                  <span class="ambient-toggle-desc">Route shell execution through Docker/Podman when available</span>
                </div>
                <label class="toggle-switch">
                  <input type="checkbox" id="cap-flag-container-execution">
                  <span class="toggle-slider"></span>
                </label>
              </div>

              <div class="capability-platform-status">
                <div id="capability-platform-summary" class="capability-platform-summary">Loading capability platform status‚Ä¶</div>
                <div id="capability-platform-container-runtime" class="capability-platform-runtime"></div>
                <div id="capability-platform-container-policy" class="capability-platform-runtime"></div>
                <div id="capability-platform-mcp-runtime" class="capability-platform-runtime"></div>
                <div id="capability-platform-mcp-processes" class="capability-platform-processes"></div>
                <button id="capability-platform-refresh" class="secondary" type="button">Refresh Runtime Status</button>
              </div>
            </div>

            <div class="form-group">
              <label for="telegram-token-input">Bot Token</label>
              <div class="telegram-token-row">
                <input type="password" id="telegram-token-input" placeholder="Paste token from @BotFather"
                  autocomplete="off" spellcheck="false">
                <button id="telegram-save-token-btn" class="primary" type="button">Save</button>
              </div>
              <span class="telegram-hint">Get a token from <strong>@BotFather</strong> on Telegram</span>
            </div>

            <div class="form-group">
              <div class="telegram-toggle-row">
                <label class="telegram-toggle-label" for="telegram-enable-toggle">Enable Bot</label>
                <label class="toggle-switch">
                  <input type="checkbox" id="telegram-enable-toggle">
                  <span class="toggle-slider"></span>
                </label>
              </div>
            </div>

            <div class="form-group">
              <div id="telegram-status" class="telegram-status">
                <span class="telegram-status-dot telegram-status-dot--gray"></span>
                <span class="telegram-status-text">Not configured</span>
              </div>
            </div>

            <div id="telegram-auth-section" class="form-group hidden">
              <label>Authorized User</label>
              <div class="telegram-auth-row">
                <span id="telegram-auth-id" class="telegram-auth-id">‚Äî</span>
                <button id="telegram-clear-auth-btn" class="danger" type="button">Clear</button>
              </div>
            </div>

            <div class="telegram-setup-help">
              <p>1. Open Telegram and message <strong>@BotFather</strong></p>
              <p>2. Send <code>/newbot</code> and follow the prompts</p>
              <p>3. Copy the token and paste it above</p>
              <p>4. Enable the bot and send a message to it from Telegram</p>
            </div>

            <button id="save-settings" class="primary">Save</button>
          </div>
        </div>
      </div>

      <!-- Task report is now shown inline in chat output (no modal needed) -->

      <!-- Browser Panel (right 50%) -->
      <div id="panel-container" class="panel-container">
        <div class="panel">
          <div class="panel-header">
            <div class="panel-header-spacer"></div>
            <div class="panel-window-controls">
              <button id="panel-min-btn" class="window-btn" title="Minimize">‚Äì</button>
              <button id="panel-max-btn" class="window-btn" title="Maximize">‚ñ°</button>
              <button id="panel-close-btn" class="window-btn window-btn-close" title="Close">√ó</button>
            </div>
          </div>

          <div class="tab-strip">
            <div class="source-tabs" id="source-tabs" role="tablist" aria-label="Research sources"></div>
            <div class="browser-menu-container">
              <button id="browser-menu-btn" class="browser-menu-btn" title="Browser menu">&#8942;</button>
              <div id="browser-menu-dropdown" class="browser-menu-dropdown hidden">
                <div id="browser-menu-body" class="browser-menu-body"></div>
              </div>
            </div>
          </div>
          <div class="browser-controls">
            <div class="browser-nav">
              <button class="nav-btn" id="browser-back" title="Back">‚Üê</button>
              <button class="nav-btn" id="browser-forward" title="Forward">‚Üí</button>
              <button class="nav-btn" id="browser-reload" title="Reload">‚Üª</button>
            </div>
            <div class="browser-url-bar">
              <div class="browser-url-input-wrap">
                <input type="text" id="browser-url" placeholder="Search or enter URL" spellcheck="false"
                  autocomplete="off" aria-autocomplete="list" aria-expanded="false">
                <div id="browser-url-suggestions" class="browser-url-suggestions hidden" role="listbox"
                  aria-label="URL history suggestions"></div>
              </div>
              <button class="nav-btn" id="browser-go" title="Go">‚Üí</button>
            </div>
          </div>

          <div class="browser-placeholder">
            <p id="browser-hidden-quote" class="browser-hidden-quote hidden">EVEN THE MONA LISA'S FALLING APART</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script type="module" src="main.ts"></script>
</body>

</html>
